<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/public/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/public/css/styles.css">
    <link rel="stylesheet" type="text/css" href="/public/css/home_styles.css">
    <title>Home</title>
</head>


<body class="vertical_flex_centered" onload="onLoad()">


<div id="body_content">
    <h1 id="welcome_text">Bienvenido, </h1>

    <div id="project_grid">
        <div class="project_item" onclick="load_project(1)">
            <img class="placeholder_project_image" alt="preview" src="/public/res/raster/projectCoverPlaceholder.png">
            <p class="project_title">Proyecto 1 con un nombre bien largo que ocupa todo el espacio disponible</p>
            <p class="project_date">01/02/03</p>
        </div>

        <div class="project_item" onclick="load_project(2)">
            <img class="placeholder_project_image" alt="preview" src="/public/res/raster/projectCoverPlaceholder.png">
            <p class="project_title">Proyecto 2</p>
            <p class="project_date">01/02/03</p>
        </div>

        <div class="project_item" onclick="load_project(3)">
            <img class="placeholder_project_image" alt="preview" src="/public/res/raster/projectCoverPlaceholder.png">
            <p class="project_title">Proyecto 3</p>
            <p class="project_date">01/02/03</p>
        </div>

        <div class="project_item" onclick="load_project(4)">
            <img class="placeholder_project_image" alt="preview" src="/public/res/raster/projectCoverPlaceholder.png">
            <p class="project_title">Proyecto 4</p>
            <p class="project_date">01/02/03</p>
        </div>

        <div class="project_item" onclick="load_project(5)">
            <img class="placeholder_project_image" alt="preview" src="/public/res/raster/projectCoverPlaceholder.png">
            <p class="project_title">Proyecto 5</p>
            <p class="project_date">01/02/03</p>
        </div>

        <div class="project_item" onclick="load_project(6)">
            <img class="placeholder_project_image" alt="preview" src="/public/res/raster/projectCoverPlaceholder.png">
            <p class="project_title">Proyecto 6</p>
            <p class="project_date">01/02/03</p>
        </div>

        <div class="project_item in_capture" onclick="load_capture(7)">
            <img class="placeholder_project_image" alt="preview en carga" src="/public/res/raster/projectCoverCapturePlaceholder.png">
            <p class="project_title">Proyecto 7</p>
            <p class="project_date">01/02/03</p>
        </div>
    </div>
</div>


</body>


</html>
<script>

    function getCookie(needle) {
        return document.cookie.split(';').map(function(cookiestring) {
            cs = cookiestring.trim().split('=');

            if(cs.length === 2) {
                return {'name' : cs[0], 'value' : cs[1]};
            } else {
                return {'name' : '', 'value' : ''};
            }
        })
        .filter(function(cookieObject) { 
            return (cookieObject.name === needle);
        });
    }


    function updateNameTemplate() {
        let banner = document.getElementById("welcome_text")

        let text = banner.innerText || element.textContent;

        banner.innerHTML = text + " " + getCookie("name")[0]["value"];
    }

    function onLoad() {

        window.top.document.title = "Home"

        // load username
        let name_cookies = getCookie("name");
        let user_id      = getCookie("oauth_user_id");
        if (Object.keys(name_cookies).length == 0 || Object.keys(user_id).length == 0) {
            let request = new XMLHttpRequest();
            request.open("GET", "https://www.googleapis.com/userinfo/v2/me/");
            request.setRequestHeader("Authorization", "Bearer " + getCookie("oauth_token")[0]["value"])
            request.onload = () => { 
                console.log(request.response);
                let json = JSON.parse(request.responseText);
                document.cookie = "name="+json["given_name"];
                document.cookie = "oauth_user_id="+json["id"]+"; path=/";
                updateNameTemplate();
            }
            request.send();
        } else {
            updateNameTemplate();
        }
    }

    function load_project(id) {
        window.top.document.location="/view/"+id;
    }

    function load_capture(id) {
        window.top.document.location="/capture/"+id;
    }
</script>